#!/bin/bash
TARGETDIR=${PWD##*/}

INFILE=$1
OUT=$2
ERA=$3
RUNPERIOD=$4
XSECTION=$5
JOB=$6
BASEDIR=$7
OUTPUTDIR=$8
echo INFILE         $INFILE
echo OUT            $OUT
echo ERA            $ERA
echo RUNPERIOD      $RUNPERIOD
echo XSECTION       $XSECTION
echo JOB            $JOB
echo BASEDIR        $BASEDIR
echo OUTPUTDIR      $OUTPUTDIR



echo "Processing ${INFILE} for Job ${OUT}_${JOB}"

source /etc/profile
source /cvmfs/cms.cern.ch/cmsset_default.sh
source /cvmfs/grid.desy.de/etc/profile.d/grid-ui-env.sh

module use -a /afs/desy.de/group/cms/modulefiles/
module load cmssw
cd ${BASEDIR}
eval `scramv1 runtime -sh` #cmsenv

export X509_USER_PROXY=/nfs/dust/cms/user/wiens/x509up

#Do the skimming
mkdir -p ${OUTPUTDIR}
cd ${OUTPUTDIR}

echo NanoSkim ${INFILE} ${OUT}_${JOB}.root ${ERA} ${RUNPERIOD} ${XSECTION}
NanoSkim ${INFILE} ${OUT}_${JOB}.root ${ERA} ${RUNPERIOD} ${XSECTION}
